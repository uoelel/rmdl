{
  "hash": "2b63a0f3e0f06fc6256c3978c8ed301e",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"RMDL -- Week 5\"\nsubtitle: \"Varying effects I\"\nbibliography: references.bib\n---\n\n\n::: {.cell}\n\n:::\n\n\n## Introduction\n\n::: callout-warning\n#### Create a Quarto RStudio project for this course\n\nCreate an RStudio project for the course and within that add the usual folders `data/` and `code/` (do not include the forward slash `/` in the name! It is just there to mark that those are folders.)\n\nWhen working through these tutorials, **make sure you are in the course Quarto/RStudio Project** you created.\n\nYou know you are in a Quarto Project because you can see the name of the Project in the top-right corner of RStudio, next to the light-blue cube icon.\n\nIf you see `Project (none)` in the top-right corner, that means **you are not** in a Quarto Project.\n\nTo make sure you are in the Quarto project, you can open the project by going to the project folder in File Explorer (Win) or Finder (macOS) and double click on the `.Rproj` file.\n:::\n\nIn this tutorial, you have to run Bayesian regression models with data from @winter2012.\n\nYou can get the data [here](/data/winter2012/polite.csv) (right-click and download).\nThis page explains the meaning of the columns in the data: <https://uoelel.github.io/qml-data/data/winter2012/polite.html>.\n\n## Mean f0\n\nFit a regression model to answer the following question:\n\n> Do the months spent in Germany modulate the effect of attitude on mean f0?\n\nThe model should have the following variables:\n\n-   `f0mn` as the outcome variable.\n-   `gender`, `months_ger` and `attitude` as predictors.\n-   Add varying effects as needed.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npolite <- read_csv(\"data/winter2012/polite.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 224 Columns: 27\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (6): subject, gender, birthplace, musicstudent, task, attitude\ndbl (21): months_ger, scenario, total_duration, articulation_rate, f0mn, f0s...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n:::\n\n\nWe fit a Bayesian regression model with mean f0 as the outcome variable, using a Gaussian family.\nAs predictors, we include gender, attitude and months spent in Germany, including all interactions.\nWe also let the effect of attitude to vary by subject.\n(The effects of gender and months in Germany cannot vary by subject because they are within-subject variables).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nf0_bm <- brm(\n  f0mn ~ gender * attitude * months_ger +\n    (attitude | subject),\n  family = gaussian,\n  data = polite,\n  cores = 4,\n  seed = my_seed,\n  file = \"data/cache/f0_bm\"\n)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(f0_bm, prob = 0.9)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n Family: gaussian \n  Links: mu = identity; sigma = identity \nFormula: f0mn ~ gender * attitude * months_ger + (attitude | subject) \n   Data: polite (Number of observations: 212) \n  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;\n         total post-warmup draws = 4000\n\nMultilevel Hyperparameters:\n~subject (Number of levels: 16) \n                           Estimate Est.Error l-90% CI u-90% CI Rhat Bulk_ESS\nsd(Intercept)                 26.52      7.25    16.84    39.86 1.01     1213\nsd(attitudepol)                5.34      4.27     0.40    13.66 1.00     2035\ncor(Intercept,attitudepol)     0.11      0.57    -0.86     0.92 1.00     3958\n                           Tail_ESS\nsd(Intercept)                  2383\nsd(attitudepol)                1904\ncor(Intercept,attitudepol)     2826\n\nRegression Coefficients:\n                               Estimate Est.Error l-90% CI u-90% CI Rhat\nIntercept                        263.59     12.44   243.15   283.59 1.00\ngenderM                         -140.19     21.57  -174.43  -103.41 1.00\nattitudepol                      -21.65      7.56   -34.31    -9.51 1.00\nmonths_ger                        -0.15      0.13    -0.37     0.06 1.00\ngenderM:attitudepol               12.09     13.07    -8.88    33.54 1.00\ngenderM:months_ger                 0.90      0.78    -0.35     2.16 1.00\nattitudepol:months_ger             0.09      0.08    -0.04     0.22 1.00\ngenderM:attitudepol:months_ger    -0.16      0.46    -0.88     0.60 1.00\n                               Bulk_ESS Tail_ESS\nIntercept                          1224     2073\ngenderM                            1227     1635\nattitudepol                        2723     2212\nmonths_ger                         1608     2083\ngenderM:attitudepol                2271     2038\ngenderM:months_ger                 1438     1660\nattitudepol:months_ger             3395     2785\ngenderM:attitudepol:months_ger     3292     3270\n\nFurther Distributional Parameters:\n      Estimate Est.Error l-90% CI u-90% CI Rhat Bulk_ESS Tail_ESS\nsigma    31.63      1.61    29.10    34.40 1.00     5384     2969\n\nDraws were sampled using sampling(NUTS). For each parameter, Bulk_ESS\nand Tail_ESS are effective sample size measures, and Rhat is the potential\nscale reduction factor on split chains (at convergence, Rhat = 1).\n```\n\n\n:::\n:::\n\n\nThe coefficients of interest are `attitudepol:months_ger` (for females) and `genderM:attitudepol:months_ger`.\nThe 90% CrI of `attitudepol:months_ger` is \\[-0.04, 0.22\\]: for each month spent in Germany the effect of attitude (polite) changes by -0.04 to +0.22 at 90% probability.\nWhile most of CrI is positive, a negative but small interaction could exist.\nSince the effect of attitude (polite) is negative, the interaction term indicates that the effect of attitude might decrease with time spent in Germany for female speakers.\nFor male speakers, the interaction term `genderM:attitudepol:months_ger` adds more uncertainty, so it is not wise to make any inference.\nSee @fig-f0-bm for the expected mean f0 based on the model.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(\n  conditional_effects(f0_bm, \"months_ger:attitude\", conditions = make_conditions(polite, \"gender\")),\n  points = TRUE\n)\n```\n\n::: {.cell-output-display}\n![Expected mean f0 by gender, attitude and months spent in Germany.](tutorial-w05-solution_files/figure-html/fig-f0-bm-1.png){#fig-f0-bm width=672}\n:::\n:::\n\n\n## H1-H2 difference\n\nIf you have time, run another regression model to answer the following research question:\n\n> Does being a music student modulate the effect of attitude on the H1-H2 difference?\n\nThe H1-H2 difference is correlated with breathiness: the higher the difference, the more breathy the voice quality.\n\nWe fit a Bayesian regression with H1-H2 difference as the outcome variable, with a Gaussian family.\nAs predictors, the model has attitude, gender and whether the participant is a music student, including all interactions.\nWe let the affect of attitude to vary by participant by including a by-subject varying intercept and varying slope for attitude.\n@fig-h1h2-bm shows the expected H1-H2 difference depending on attitude, gender and music student based on the model.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nh1h2_bm <- brm(\n  H1H2 ~ attitude * musicstudent * gender + (attitude | subject),\n  data = polite,\n  family = gaussian,\n  cores = 4,\n  seed = my_seed,\n  file = \"data/cache/h1h2_bm\"\n)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(h1h2_bm)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n Family: gaussian \n  Links: mu = identity; sigma = identity \nFormula: H1H2 ~ attitude * musicstudent * gender + (attitude | subject) \n   Data: polite (Number of observations: 224) \n  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;\n         total post-warmup draws = 4000\n\nMultilevel Hyperparameters:\n~subject (Number of levels: 16) \n                           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS\nsd(Intercept)                  2.14      0.48     1.40     3.25 1.00     1834\nsd(attitudepol)                0.38      0.29     0.02     1.09 1.00     2163\ncor(Intercept,attitudepol)     0.06      0.52    -0.89     0.93 1.00     4795\n                           Tail_ESS\nsd(Intercept)                  2583\nsd(attitudepol)                2579\ncor(Intercept,attitudepol)     2965\n\nRegression Coefficients:\n                                    Estimate Est.Error l-95% CI u-95% CI Rhat\nIntercept                               3.49      0.93     1.69     5.32 1.00\nattitudepol                            -0.29      0.41    -1.07     0.52 1.00\nmusicstudentyes                        -1.13      1.64    -4.27     2.07 1.00\ngenderM                                 3.03      1.45     0.17     5.89 1.00\nattitudepol:musicstudentyes            -1.10      0.70    -2.45     0.32 1.00\nattitudepol:genderM                     0.46      0.64    -0.79     1.68 1.00\nmusicstudentyes:genderM                 0.48      2.39    -4.26     5.20 1.00\nattitudepol:musicstudentyes:genderM     1.47      1.03    -0.54     3.50 1.00\n                                    Bulk_ESS Tail_ESS\nIntercept                               1418     1881\nattitudepol                             3986     2977\nmusicstudentyes                         1793     2215\ngenderM                                 1696     1958\nattitudepol:musicstudentyes             4245     3144\nattitudepol:genderM                     3583     3016\nmusicstudentyes:genderM                 1765     1845\nattitudepol:musicstudentyes:genderM     4075     3061\n\nFurther Distributional Parameters:\n      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS\nsigma     1.61      0.08     1.46     1.77 1.00     5704     3095\n\nDraws were sampled using sampling(NUTS). For each parameter, Bulk_ESS\nand Tail_ESS are effective sample size measures, and Rhat is the potential\nscale reduction factor on split chains (at convergence, Rhat = 1).\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nconditional_effects(h1h2_bm, \"musicstudent:attitude\", conditions = make_conditions(polite, \"gender\"))\n```\n\n::: {.cell-output-display}\n![Expected H1-H2 difference](tutorial-w05-solution_files/figure-html/fig-h1h2-bm-1.png){#fig-h1h2-bm width=672}\n:::\n:::\n\n\nTo answer the RQ of whether the difference between informal and polite attitude is affected by whether the participant is a music student, we calculate the following estimands:\n\n-   Difference between H1-H2 in informal vs polite in female participants, separately for music students (`mus_f`) vs non-music students (`nomus_f`).\n\n-   Difference between H1-H2 in informal vs polite in male participants, separately for music students (`mus_m`) vs non-music students (`nomus_m`).\n\n-   Difference between the differences for female and male participants (`no_mus_f` and `no_mus_m`).\n    This estimand is the one we need to answer the RQ.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nh1h2_draws <- as_draws_df(h1h2_bm, \"^b_\", regex = TRUE)\nh1h2_draws <- h1h2_draws |> \n  mutate(\n    nomus_f = b_attitudepol,\n    mus_f = b_attitudepol + `b_attitudepol:musicstudentyes`,\n    no_mus_f = mus_f - nomus_f,\n    nomus_m = b_attitudepol + `b_attitudepol:genderM`,\n    mus_m = b_attitudepol + `b_attitudepol:genderM` + `b_attitudepol:musicstudentyes` + `b_attitudepol:musicstudentyes:genderM`,\n    no_mus_m = mus_m - nomus_m,\n  )\n\n# Pivot for plotting\nh1h2_music_diff <- h1h2_draws |> \n  select(no_mus_f, no_mus_m) |> \n  pivot_longer(everything())\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Dropping 'draws_df' class as required metadata was removed.\n```\n\n\n:::\n:::\n\n\n@fig-h1h2-music-diff shows the estimated difference between the by-attitude H1-H2 difference in music vs non-music students, separately for female and male students.\nThere is some indication of a difference for female participants, but not so much for male participants.\nLet's calculate 95, 80, and 60% CrI.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nh1h2_music_diff |> \n  ggplot(aes(value, fill = name)) +\n  geom_vline(xintercept = 0) +\n  geom_density(alpha = 0.5)\n```\n\n::: {.cell-output-display}\n![Music-student difference of attitude difference in H1-H2 in female and male participants.](tutorial-w05-solution_files/figure-html/fig-h1h2-music-diff-1.png){#fig-h1h2-music-diff width=672}\n:::\n:::\n\n\nThe 80% CrI \\[-1.98, -0.22\\] for female participants suggests a difference of the effect of attitude based on whether the participant is a music student or not, at 80% confidence, although the magnitude of the difference is quite uncertain and if a difference is indeed present it is less than 2 db.\nFor male participants there is a lot of uncertainty.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nh1h2_music_diff |> \n  group_by(name) |> \n  summarise(\n    ci = list(round(quantile2(value, probs = c(0.05, 0.1, 0.2, 0.8, 0.9, 0.95)), 2))\n  ) |> \n  unnest_wider(ci)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"name\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"q5\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"q10\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"q20\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"q80\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"q90\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"q95\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"no_mus_f\",\"2\":\"-2.26\",\"3\":\"-1.98\",\"4\":\"-1.69\",\"5\":\"-0.54\",\"6\":\"-0.22\",\"7\":\"0.04\"},{\"1\":\"no_mus_m\",\"2\":\"-0.86\",\"3\":\"-0.59\",\"4\":\"-0.27\",\"5\":\"0.99\",\"6\":\"1.33\",\"7\":\"1.62\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nIn sum, the results are inconclusive as to which being a music student makes a difference in H1-H2 differences between polite and informal speech for male speakers.\nFor female speakers, there might be a slightly greater difference in the H1-H2 difference of polite vs informal speech when they are music students relative to non-music students, but the difference is below 2 db.\n\n### References\n",
    "supporting": [
      "tutorial-w05-solution_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}