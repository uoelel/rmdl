---
title: "Research Methods in Developmental Linguistics -- Week 6"
subtitle: "Group-level effects: Slopes"
author: "Dr Stefano Coretta"
institute: "University of Edinburgh"
format:
  mono-light-revealjs:
    theme: [default, custom.scss]
    history: false
execute: 
  echo: false
knitr:
  opts_chunk:
    dev: "ragg_png"
---

```{r setup, include=FALSE}
library(tidyverse)
theme_set(theme_light())

library(brms)
library(tidybayes)

options(ggplot2.discrete.fill = RColorBrewer::brewer.pal(8, "Dark2"))
options(ggplot2.discrete.colour = RColorBrewer::brewer.pal(8, "Dark2"))
options(show.signif.stars = FALSE)

my_seed <- 8878
set.seed(my_seed)
options(scipen=999)
```

## Song 2020

::: box-note
-   Data from [Song 2020](https://doi.org/10.1017/S0272263120000170).

-   Shallow morphological representation in L2 speakers.

-   **Lexical decision task**: Is the word a real English word or not?

-   **Priming paradigm**:

    -   **Prime**: *prolong* (unrelated), *unkind* (constituent), *kindness* (non-constituent).

    -   **Target**: *unkindness* (*\[un-kind\]-ness*, not *un-\[kind-ness\]*).

-   English L1 and English L2/Cantonese L1 participants.
:::

## Song 2020: hypotheses

::: box-warning
Vague hypothesis:

> The Shallow Structure Hypothesis (SSH) allows the possibility for nonnative speakers to show strong priming effects from nonconstituent and constituent primes equally because the shallow processing route, which relies more heavily on semantic and surface-level information than on structural information.
:::

## Song 2020: the data

```{r}
#| label: shallow
#| echo: true

shallow <- read_csv("data/song2020/shallow.csv") |>
  filter(
    Critical_Filler == "Critical",
    Branching == "Left"
  ) |> 
  mutate(
    accuracy = ifelse(ACC == 0, "incorrect", "correct"),
    accuracy = factor(accuracy, levels = c("incorrect", "correct"))
  )
shallow
```

## Song 2020: accuracy

```{r}
#| label: shallow-acc

shallow |> 
  ggplot(aes(Relation_type, fill = accuracy)) +
  geom_bar(position = "fill") +
  facet_grid(cols = vars(Group))

```

## Bernoulli regression (accuracy)

```{r}
#| label: sha-bm-1
#| echo: true

my_seed <- 4235

sha_bm_1 <- brm(
  accuracy ~ 0 + Group:Relation_type,
  family = bernoulli,
  data = shallow,
  cores = 4,
  seed = my_seed,
  file = "data/cache/sha_bm_1"
)
```

## Bernoulli regression: expected predictions

```{r}
#| label: sha-bm-1-cond

conditional_effects(sha_bm_1, "Group:Relation_type")

```

## BUT...

::: box-error
-   Multiple observations from different participants.

-   Multiple observations from different target words.
:::

. . .

::: box-tip
-   We need to include **varying terms**.
:::

## Song 2020

```{r}
#| label: sha-bm-2
#| echo: true

sha_bm_2 <- brm(
  ACC ~ 0 + Group:Relation_type +
    (0 + Relation_type | ID) +
    (0 + Group:Relation_type | Target),
  family = bernoulli,
  data = shallow,
  cores = 4,
  seed = my_seed,
  file = "data/cache/sha_bm_2"
)
```

## Song 2020

```{r}
#| label: sha-bm-2-conds
conditional_effects(sha_bm_2, "Group:Relation_type")
```

## 
